# 重构

## 什么是重构？

重构必看的一本神书《重构：改善代码既有设计》从两个角度给出了重构的定义：

***

* 重构（名词）：对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，<mark style="color:red;">提高其可理解性，降低其修改成本</mark>。
* 重构（动词）：使用一系列重构手法，在不改变软件可观察行为的前提下，<mark style="color:red;">调整其结构</mark>。

***

用更贴近工程师的语言来说：**重构就是利用设计模式(如组合模式、策略模式、责任链模式)、软件设计原则（如 SOLID 原则、YAGNI 原则、KISS 原则）和重构手段（如封装、继承、构建测试体系）来让代码更容易理解，更易于修改。**

更全面的设计模式总结，可以看 [**java-design-patternsopen in new window**](https://github.com/iluwatar/java-design-patterns) 这个开源项目。

<figure><img src="../.gitbook/assets/image (17).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## 为什么要重构？

随着业务的迭代、代码的堆积，<mark style="color:red;">越来越多的冗余代码，打出的包越来越大，项目维护起来越来越吃力</mark>，这时候不得不考虑<mark style="background-color:purple;">重构</mark>。

在上面介绍重构定义的时候，我从比较抽象的角度介绍了重构的好处：重构的主要目的主要是提升<mark style="color:red;">代码和架构</mark>的可维护性、可扩展性、复用性。也就是说重构要从代码、架构两个方面着手。

### 重构的好处

如果对应到一个真实的项目，重构具体能为我们带来什么好处呢？

1. **让代码更容易理解**：通过添加注释、命名规范、逻辑优化等手段可以让我们的代码更容易被理解；
2. **避免代码腐化**：通过重构干掉坏味道代码；

> 代码腐化（Code Rot）是指代码随着时间的推移而逐渐变得难以理解和维护。这通常是由于代码的复杂性增加、可读性降低、缺乏测试、缺乏文档、过度设计、缺乏代码审查等原因导致的。

3. **加深对代码的理解**：重构代码的过程会加深你对某部分代码的理解；
4. **发现潜在 bug**：是这样的，很多潜在的 bug ，都是我们在重构的过程中发现的；
5. 发现并删除未被引用的代码，无效代码等
6. 对于组件，采用Headless UI的思维将逻辑抽象出来，实现逻辑与View分离，提升逻辑复用性、样式（通常样式会经常变更）与逻辑互不干扰
7. 公共业务组件、业务逻辑的提取，提升复用性、可维护性，减少代码冗余

### 终极目标

看了上面介绍的关于重构带来的好处之后，你会发现重构的最终目标是 **提高软件开发速度和质量** 。

重构并不会减慢软件开发速度，相反，如果代码质量和软件设计较差，当我们想要添加新功能的话，开发速度会越来越慢。到了最后，甚至都有想要重写整个系统的冲动。

《重构：改善代码既有设计》这本书中这样说

> 重构的唯一目的就是让我们开发更快，用更少的工作量创造更大的价值

## 何时重构

开发与重构并不需要分的太清楚，开发一个需求之前可以先熟悉涉及的业务代码，仔细研读，如果发现可以重构的地方，设计重构方案，然后按照方案开发。

可以考虑重构的场景包含但不局限于以下几点：

* **可读性差**：如果遇到晦涩难懂的代码，可以考虑重构
* **API不友好**：如果发现提供的API不够友好，调用起来不是很方便，可以考虑重构对外API
* **代码冗余**：如果发现很多冗余的代码，可以考虑抽出公共逻辑。比如同一个功能、变量、方法在多处定义，遵循只定义一次的原则，抽离出来。
* **函数体过大**：一个函数体包含很长的逻辑，可以考虑拆分，抽象逻辑等
* **命名不规范、变量名长度太长**
* **逻辑分散**：同一业务的不同方法，分散在不同模块中，建议规整到一个目录底下，统一对外
* **缺少注释、过时注释**：注释也要精简明了
* ... ...

有一个两顶帽子的比喻：在我开发新功能之前，我发现重构可以让新功能的开发更容易，于是我戴上了重构的帽子。重构之后，我换回原来的帽子，继续开发新能功能。新功能开发完成之后，我又发现自己的代码难以理解，于是我又戴上了重构帽子。比较好的开发状态就是就是这样在重构和开发新功能之间来回切换。

<figure><img src="../.gitbook/assets/{83EA15BC-9A91-4249-B9E9-DA25F942B8E3}.png" alt=""><figcaption></figcaption></figure>



***

按重构颗粒度划分，可分层架构重构、代码重构。

## 架构重构

架构重构：架构上需要调整的，影响范围较大。架构重构是指对软件系统的整体结构进行修改，以提高其可维护性、可扩展性和性能。这通常涉及到对系统的模块、组件、接口和通信方式进行修改。架构重构可能需要重新设计系统的架构，并可能涉及到代码的重写。

以下是一些常见的架构重构技巧：

1. **微服务架构**：将单体应用拆分为多个小型、独立的服务，每个服务负责处理特定的业务功能。这可以提高系统的可扩展性和可维护性。
2. **事件驱动架构**：使用事件驱动架构，系统中的各个组件通过事件进行通信。这可以提高系统的可扩展性和可维护性。
3. **领域驱动设计（DDD）**：将系统划分为不同的领域，每个领域都有自己的模型和业务逻辑。这可以提高系统的可维护性和可扩展性。
4. **服务网格（Service Mesh）**：使用服务网格，可以将服务的通信和治理功能从应用程序代码中分离出来。这可以提高系统的可维护性和可扩展性。
5. **容器化和编排**：使用容器化和编排技术（如Docker和Kubernetes），可以将应用程序部署到容器中，并自动管理容器的生命周期。这可以提高系统的可扩展性和可维护性。
6. **API网关**：使用API网关，可以将多个微服务暴露为一个统一的API。这可以提高系统的可维护性和可扩展性。

更适用于<mark style="background-color:purple;">**前端架构重构**</mark>的一些技巧有：

1. **模块化**：将前端应用拆分为多个模块，每个模块负责处理特定的功能。这可以提高前端应用的可维护性和可扩展性。
2. **组件化**：将前端应用拆分为多个组件，每个组件负责处理特定的UI元素。这可以提高前端应用的可维护性和可扩展性。
3. **路由管理**：使用路由管理器，可以管理前端应用的路由和导航。这可以提高前端应用的可维护性和可扩展性。
4. **状态管理**：使用状态管理器，可以管理前端应用的状态。这可以提高前端应用的可维护性和可扩展性。
5. **服务化**：将前端应用拆分为多个服务，每个服务负责处理特定的业务逻辑。这可以提高前端应用的可维护性和可扩展性。
6. **微前端**：将前端应用拆分为多个小型、独立的前端应用，每个前端应用负责处理特定的业务功能。这可以提高前端应用的可扩展性和可维护性。

### <mark style="background-color:purple;">1. 目录结构</mark>

<mark style="background-color:purple;">架构的管理，最终提现在目录结构上</mark>。目录结构是组织和管理代码的一种方式，它可以帮助开发者理解代码的结构和关系，提高代码的可维护性和可扩展性。

以下是一些常见的目录结构：

1. **模块化目录结构**：将代码按照功能或模块进行组织，每个模块有自己的目录，包含相关的代码文件。例如，一个前端应用可能有 `components`、`pages`、`services` 等目录。
2. **组件化目录结构**：将代码按照组件进行组织，每个组件有自己的目录，包含相关的代码文件。例如，一个前端应用可能有 `Button`、`Input`、`Modal` 等目录。
3. **功能化目录结构**：将代码按照功能进行组织，每个功能有自己的目录，包含相关的代码文件。例如，一个前端应用可能有 `auth`、`profile`、`dashboard` 等目录。
4. **分层目录结构**：将代码按照层次进行组织，每个层次有自己的目录，包含相关的代码文件。例如，一个前端应用可能有 `components`、`containers`、`services` 等目录。
5. **领域驱动目录结构**：将代码按照领域进行组织，每个领域有自己的目录，包含相关的代码文件。例如，一个电子商务应用可能有 `product`、`order`、`user` 等目录。

### 2. 规范编辑器的配置

从以下方面着手：

（1）对于同一个开发语言，要有统一的编码规范，下载同一种约束代码结构的插件，如prettier、**ESLint**

（2）统一代码规范的配置，比如eslint的配置

（3）为了提升开发效率

* 可以统一下载一些有预提示的插件，比如**VSCode IntelliSens（**它内置了IntelliSense功能，可以帮助你自动完成代码，并提供代码提示和错误检查**）、**JSDoc（用于生成JavaScript文档的工具，它可以帮助你编写代码注释，并提供自动完成的功能）
* 比如可以自定义Snip（切片代码），适用于开发项目的特定业务场景

### 3. 组件文档

组件文档是软件架构的一部分，它描述了软件系统的组件及其之间的关系。组件文档通常包括组件的名称、描述、接口、属性、事件、方法等详细信息。

组件文档可以帮助开发者理解和使用组件，提高软件的可维护性和可扩展性。在开发过程中，应该定期更新组件文档，以反映组件的变化和改进。

### 4. 测试框架

对于前端来说，单元测试框架确实是架构的一部分，因为它直接影响到代码的质量和可维护性。单元测试框架提供了一种机制，可以验证代码的各个部分（即单元）是否按照预期工作。

以下是一些常见的单元测试框架：

1. **Jest**：Jest是一个流行的JavaScript测试框架，它提供了丰富的功能，如断言、模拟、快照测试等。
2. **Mocha**：Mocha是一个灵活的JavaScript测试框架，它允许你编写异步测试，并提供丰富的插件系统。
3. **Jasmine**：Jasmine是一个行为驱动开发（BDD）的测试框架，它提供了丰富的断言和模拟功能。
4. **Cypress**：Cypress是一个端到端的测试框架，它允许你编写测试，模拟用户交互，并验证应用程序的行为。
5. **Enzyme**：Enzyme是一个React测试工具库，它允许你编写和运行React组件的测试。

这些单元测试框架可以帮助你编写和运行测试，并帮助你发现代码中的错误。它们还提供了一些最佳实践，可以帮助你编写可测试的代码。

### 5. 打包工具选型、配置等

### 6. 设计模式选型



## 代码重构

代码重构：代码重构是指对软件系统的源代码进行修改，以提高其可读性、可维护性和可扩展性。这通常涉及到对代码的重新组织、优化和清理。代码重构通常不需要重新设计系统的架构，也不需要代码的重写。

以下是一些常见的代码重构技巧：

1. **提取方法**：将一段复杂的代码提取到一个单独的方法中，可以提高代码的可读性和可维护性。
2. **合并重复代码**：如果代码中有重复的部分，应该将它们合并到一个地方，以避免代码重复。
3. **使用常量或枚举**：对于重复使用的值，应该使用常量或枚举来代替，以提高代码的可读性和可维护性。
4. **简化条件语句**：复杂的条件语句应该被简化，以提高代码的可读性和可维护性。例如，可以使用短路评估、三元运算符或逻辑运算符来简化条件语句。
5. **使用设计模式**：根据具体的需求，可以使用设计模式来改进代码的结构和性能。例如，可以使用工厂模式、单例模式或观察者模式来改进代码。
6. **优化算法**：如果代码的性能存在问题，应该优化算法以提高性能。例如，可以使用更高效的排序算法、搜索算法或数据结构。
7. **添加注释和文档**：对于复杂的代码，应该添加注释和文档，以提高代码的可读性和可维护性。
8. **重构命名**：对于不清晰的变量、函数或类的命名，应该进行重构，以提高代码的可读性和可维护性。

### 开发原则

### 编码规范等（可读性）

### 设计模式

### 代码执行效率提升

### 组件优化

### 作用域升级（组件作用范围提升）

这里组件不仅仅是View组件，任何一段具有一定功能的代码都可以称为组件。



参考：

[https://javaguide.cn/system-design/basis/refactoring.html#%E5%A6%82%E4%BD%95%E7%BB%83%E4%B9%A0%E9%87%8D%E6%9E%84](https://javaguide.cn/system-design/basis/refactoring.html#%E5%A6%82%E4%BD%95%E7%BB%83%E4%B9%A0%E9%87%8D%E6%9E%84)

[https://juejin.cn/post/6954378167947624484](https://juejin.cn/post/6954378167947624484)





