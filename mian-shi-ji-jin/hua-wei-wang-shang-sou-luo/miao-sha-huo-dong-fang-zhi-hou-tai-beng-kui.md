# 秒杀活动防止后台崩溃

秒杀活动可能会导致后台服务器压力过大，从而崩溃，前端可以通过减少提交接口的方式

## 前端处理办法

前端在处理秒杀活动时，主要关注的是如何提高用户体验，减少用户等待时间，并<mark style="color:red;">防止用户重复提交订单</mark>。以下是一些前端处理秒杀活动的建议：

* **防止重复提交**：
  * **只允许请求一次（**<mark style="background-color:orange;">不太合理）</mark>：在用户点击“提交订单”按钮后，不论是否成功，均禁用按钮，防止再次请求。
  * **只允许提交一次**：在用户提交订单成功后，禁用按钮。同时，可以在服务器端验证订单的唯一性，防止重复订单。
  * **节流（Throttle）：提交订单后，一段时间内不允许重复提交。**
* **用户体验**
  * **显示加载状态**：在提交订单后，可以显示一个加载状态，让用户知道订单正在处理中。这可以减少用户的焦虑，提高用户体验。
  * **处理错误**：如果服务器返回错误，可以显示错误信息，并给出相应的解决方案。例如，如果库存不足，可以显示“库存不足，请稍后再试”。另外对于后端崩溃，接口非正常的异常报错，前端需要有人性化提示
* **产品角度**
  * **限制购买数量**：在用户购买商品时，可以限制用户一次购买的最大数量，防止用户一次性购买过多商品。
* **使用CDN**：如果秒杀活动涉及大量的静态资源，可以使用CDN来加速资源的加载，减少服务器的压力。
* 与后端接口配合，共同减少服务器压力，根据不同状态，不同处理
  * 后端会判断用户是否有权限，无权限，跳转到授权页面，让用户授权（比如token失效）
    * 如果接口提交成功，返回订单状态。
      * 订单<mark style="color:blue;">成交</mark>，跳转到查看成交订单的页面
      * 订单在<mark style="color:blue;">排队</mark>中（后端会有队列，依次处理订单），这种情况后端可以评估下一次不算忙的时间节点给到前端，前端倒计时（后台），倒计时期间，点击“提交”按钮，前端提示“服务器正在处理中”，当倒计时结束后，调用查询订单状态的接口。
    * 如果接口提交失败，失败原因提示。



## 后端处理办法

1. **限流**：限制并发请求的数量，可以使用令牌桶算法或漏桶算法来实现。当请求超过限制时，可以返回错误信息或排队等待。
2. **异步处理**：将秒杀请求放入消息队列中，后台服务器可以按照自己的处理能力异步处理请求。这样可以避免大量请求同时到达服务器，导致服务器崩溃。
3. **负载均衡**：使用负载均衡器将请求分发到多个服务器上，可以分散服务器的压力。可以使用硬件负载均衡器，也可以使用软件负载均衡器，如Nginx或HAProxy。
4. **缓存**：将常用的数据缓存到内存中，可以减少数据库的访问次数，降低服务器的压力。可以使用Redis或Memcached等缓存系统。
5. **数据库优化**：优化数据库查询，使用索引，避免全表扫描。可以使用读写分离，将读操作和写操作分离到不同的数据库上。
6. **限购**：限制每个用户的购买数量，可以避免单个用户占用过多的服务器资源。
7. **降级服务**：当服务器压力过大时，可以降级服务，例如返回错误信息或部分功能不可用，而不是让服务器崩溃。
8. **监控和报警**：使用监控系统实时监控服务器的状态，当服务器压力过大或崩溃时，可以及时收到报警，并采取措施进行处理。

