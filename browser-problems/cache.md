# 浏览器缓存
## 1.常见Web网络缓存机制
从浏览器输入URL后，先后经过解析域名、请求发送、数据通道传播数据、与服务器建立连接、数据返回、客户端接收到数据进行解析并渲染的过程中，客户端（浏览器）、网络模型的各个层、服务端等的处理都会影响到网页的响应时间，其中缓存技术是常用的提高网络性能的方式。常用的web网络的缓存机制：
* 数据库缓存：对于大数据的查询，通过缓存可以避免多表链接查询，从而快速从缓存中查询结果，快速响应。
* （代理）服务器缓存：一般使用代理服务器，它存在于客户端和源服务器之间的一种中间服务器，这种代理服务器接收多个客户端的数据请求，属于公有缓存，这种缓存能大量减少多个客户端相同的资源请求，有效降低源服务器的负载压力。
代理服务器缓存是代理服务器存储网络资源的一种方式。代理服务器会根据HTTP响应头中的Cache-Control、Expires等指令，将网络资源存储在本地。当用户访问相同的资源时，代理服务器会直接从本地获取，而不是从网络下载。
* 客户端（浏览器）缓存：利用客户端提供缓存技术进行缓存，可以减少重复资源的加载，一方面可减少网络带宽，减少服务器负载压力，一方面从本地获取相应资源，快速响应。
* CDN缓存：CDN（内容分发网络）缓存是CDN存储网络资源的一种方式。CDN会根据HTTP响应头中的Cache-Control、Expires等指令，将网络资源存储在CDN节点上。当用户访问相同的资源时，CDN节点会直接从本地获取，而不是从网络下载。
* HTTP缓存：HTTP缓存是HTTP协议提供的一种缓存机制。HTTP协议定义了一些缓存指令，如Cache-Control、Expires等，用于控制缓存的行为。服务器可以通过设置这些指令，来控制资源的缓存策略。

其中客户端缓存、HTTP缓存属于前端的范畴，从下面几个小节去梳理。

## 2 本地缓存
### 2.1 cookie&session
session和cookie往往是不能单独出现的，session是后端的术语，而cookie是前端存储session的机制，在http请求时，浏览器会自动带上cookie内容。
客户端访问服务器的流程如下:
* 首先，客户端会发送一个http请求到服务器端。
* 服务器端接受客户端请求后，建立一个session，并发送一个http响应到客户端，这个响应头，其中就包含Set-Cookie头部。该头部包含了sessionId。
* 在客户端发起的第二次请求，假如服务器给了set-Cookie，浏览器会自动在请求头中添加cookie
* 服务器接收请求，分解cookie，验证信息，核对成功后返回response给客户端
### 2.2 localStorage&sessionStorage
Web 存储对象 localStorage 和 sessionStorage 允许我们在浏览器上保存键/值对。在页面刷新后（对于 sessionStorage）甚至浏览器完全重启（对于 localStorage）后，数据仍然保留在浏览器中。
我们已经有了 cookie。为什么还要其他存储对象呢？
* 与 cookie 不同，Web 存储对象不会随每个请求被发送到服务器。因此，我们可以保存更多数据。大多数现代浏览器都允许保存至少 5MB 的数据（或更多），并且具有用于配置数据的设置。
* 还有一点和 cookie 不同，服务器无法通过 HTTP header 操纵存储对象。一切都是在 JavaScript 中完成的。
* 存储绑定到源（域/协议/端口三者）。也就是说，不同协议或子域对应不同的存储对象，它们之间无法访问彼此数据。
localStorage&sessionStorage区别
sessionStorage是一个会话窗口一个sessionStorage存储空间，也就是说重新打开一个Page(Tab)，会话存储空间初始都是空的。
而localStorage是一个源（origin:协议+主机+端口)，对应一个localStorage存储空间，即使会话关闭，其state仍然存在硬盘上。
### 2.3 IndexDB
常用工具库：inDB
### 2.4 webSQL
本地的数据库，各浏览器兼容性不是很好，用的场景也不多。W3C 在 2010 年将它从标准中移除了。
### 2.5 Application Cache
Application Cache（应用程序缓存）是HTML5提供的一种缓存机制，它可以缓存整个网页或网页的一部分。Application Cache可以缓存静态资源，如HTML、CSS、JavaScript、图片等，也可以缓存动态资源，如API请求等。
以下是一些关于Application Cache的详细说明：
1. **manifest文件**：Application Cache使用一个manifest文件来定义需要缓存的资源。manifest文件是一个文本文件，它包含了需要缓存的资源的URL列表。
2. **缓存策略**：Application Cache定义了三种缓存策略：缓存、网络和仅网络。缓存策略决定了在用户访问资源时，浏览器应该如何处理缓存。
   	- 缓存：如果资源在缓存中，浏览器会直接从缓存中获取资源。如果资源不在缓存中，浏览器会从网络下载资源，并将资源添加到缓存中。
   	- 网络：如果资源在缓存中，浏览器会直接从缓存中获取资源。如果资源不在缓存中，浏览器会从网络下载资源，但不将资源添加到缓存中。
   	- 仅网络：浏览器会从网络下载资源，但不将资源添加到缓存中。
3. **缓存更新**：当manifest文件发生变化时，浏览器会自动更新缓存。开发者可以通过修改manifest文件，来更新缓存。
4. **缓存失效**：当资源发生变化时，浏览器会自动更新缓存。开发者可以通过设置HTTP响应头中的Cache-Control、Expires等指令，来控制资源的缓存策略。
Application Cache是一种强大的缓存机制，它可以缓存整个网页或网页的一部分，从而提高网页的加载速度和性能。然而，Application Cache也有一些缺点，如缓存更新问题、缓存失效问题等。因此，在使用Application Cache时，需要根据实际情况进行权衡和优化。
## 2.6 service worker 缓存
Service Worker是浏览器提供的一种后台运行机制，它可以拦截和处理网络请求。Service Worker可以缓存网络资源，并在用户访问时直接从缓存中获取，而不是从网络下载。


## HTTP缓存（强缓存&弱缓存）
强缓存和弱缓存是HTTP缓存中的两种缓存策略，它们决定了浏览器如何处理缓存的资源。

1. **强缓存**：强缓存是指浏览器在本地缓存中找到了资源的副本，并且该资源的缓存有效期还没有过期。当浏览器需要再次请求该资源时，它会直接从本地缓存中获取，而不需要向服务器发送请求。强缓存的实现依赖于HTTP响应头中的Cache-Control和Expires字段。

2. **弱缓存**：弱缓存是指浏览器在本地缓存中找到了资源的副本，但是该资源的缓存有效期已经过期。当浏览器需要再次请求该资源时，它会向服务器发送一个条件请求（如If-Modified-Since或If-None-Match），服务器会根据资源的最新状态来决定是否返回资源的最新版本。弱缓存的实现依赖于HTTP响应头中的ETag和Last-Modified字段。

总的来说，强缓存和弱缓存都是HTTP缓存中的缓存策略，它们决定了浏览器如何处理缓存的资源。强缓存适用于资源不经常变化的场景，而弱缓存适用于资源经常变化的场景。


